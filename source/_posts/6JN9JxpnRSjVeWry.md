---
title: 安卓优化-线程优化
tags:
  - 性能优化
categories: Android
updated: 1635684518000
date: 2021-10-31 20:48:51
---

### 线程调度

> 任意时刻，只有一个线程占用CPU，处于运行状态

多线程并发：轮流获取cpu使用权  
JVM负责线程调度：按照特定调度模型分配CPU使用权

#### 调度模型

- 分时调度模型: 轮流获取,均匀分配cpu时间
- 抢占式调度模型:  按照优先级来

<!-- more -->
### Android异步方式

- Thread
	-  最简单、常见的方式  
	-  不易复用，频繁创建销毁开销大
- HandlerThread
	-  自带消息循环的线程
	-  串行执行,长时间运行，不断从队列中获取任务
- IntentService
	- 继承自Service在内部创建HandlerThread  
	- 异步、不占用主线程  
	- 优先级高，不易被系统kil
- AsyncTask
	- Android提供的工具类  
	- 无需自己处理线程切换
- 线程池
	- jdk提供的线程池  
	- 易复用，减少频繁创建、销毁的时间  
	- 功能强大：定时、任务列队、并发数控制等
- RxJava
	- 由强大的Scheduler集合提供  
	- 不同类型的区分：IO密集型、CPU密集型
- 协程

### 线程使用准则

1、严禁使用new Thread,因为这样不便控制,可能产生预期之外的事情
2、提供基础线程池供各个业务栈使用（避免各个业务栈各自维护一套线程池，导致线程数过多）
3、根据任务类型选择合适的异步方式（优先级低长时间执行-HandlerThread，定时执行-线程池）
4、创建线程必须命名（方便定位线程归属，运行期Thread.currentThread().setName修改名字）
5、关键异步任务监控（异步不等于不耗时，AOP的方式来做监控）
6、重视优先级的设置（Process.setThreadPriority(),可以设置多次）